{# Override EasyAdmin layout to add industry indicator and data-industry attribute #}
{% extends '@!EasyAdmin/layout.html.twig' %}

{# Add data-industry attribute to body #}
{% block body_attr %}
    {{ parent() }}
    data-industry="{{ current_industry_value|default('') }}"
{% endblock %}

{# Add industry indicator in sidebar, before main menu #}
{% block main_menu_wrapper %}
    {% if has_industry %}
        <div class="industry-indicator-sidebar">
            <i class="fa fa-industry"></i>
            <span>{{ current_industry.label }}</span>
        </div>
    {% endif %}

    {{ parent() }}
{% endblock %}

{# Add custom JavaScript for source-specific form fields #}
{% block body_javascript %}
    {{ parent() }}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Discovery source field toggle logic
        const sourceSelector = document.querySelector('[data-source-selector]');
        if (!sourceSelector) return;

        const queryBasedSources = ['google', 'seznam', 'firmy_cz', 'ekatalog', 'zive_firmy', 'najisto', 'zlatestranky'];

        function updateFieldVisibility() {
            const selectedSource = sourceSelector.value;
            const queryFields = document.querySelectorAll('.query-based-field');
            const atlasFields = document.querySelectorAll('.atlas-skolstvi-field');
            const seznamSkolFields = document.querySelectorAll('.seznam-skol-field');
            const seznamSkolEuFields = document.querySelectorAll('.seznam-skol-eu-field');
            const jmkFields = document.querySelectorAll('.jmk-katalog-skol-field');
            const brnoFields = document.querySelectorAll('.brno-katalog-skol-field');

            // Show/hide query-based fields
            queryFields.forEach(function(field) {
                field.style.display = queryBasedSources.includes(selectedSource) ? '' : 'none';
            });

            // Show/hide Atlas Školství fields
            atlasFields.forEach(function(field) {
                field.style.display = (selectedSource === 'atlas_skolstvi') ? '' : 'none';
            });

            // Show/hide Seznam Škol fields
            seznamSkolFields.forEach(function(field) {
                field.style.display = (selectedSource === 'seznam_skol') ? '' : 'none';
            });

            // Show/hide Seznam Škol EU fields
            seznamSkolEuFields.forEach(function(field) {
                field.style.display = (selectedSource === 'seznam_skol_eu') ? '' : 'none';
            });

            // Show/hide JMK Katalog Škol fields
            jmkFields.forEach(function(field) {
                field.style.display = (selectedSource === 'jmk_katalog_skol') ? '' : 'none';
            });

            // Show/hide Brno Katalog Škol fields
            brnoFields.forEach(function(field) {
                field.style.display = (selectedSource === 'brno_katalog_skol') ? '' : 'none';
            });
        }

        // Initial state
        updateFieldVisibility();

        // Listen for changes
        sourceSelector.addEventListener('change', updateFieldVisibility);
    });
    </script>
{% endblock %}
